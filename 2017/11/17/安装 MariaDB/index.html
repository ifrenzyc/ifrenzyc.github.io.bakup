<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="MySQL 的版本选择及安装部署KMAS 前后端均采用 MySQL 协议实现，由于 MySQL 及 MariaDB 均是用 MySQL 协议实现的。因此，这两个数据库都可以使用，且使用上无差别。除配置及一些特殊特性外，MySQL 和 MariaDB 基本可以互相替换。 由于 MariaDB 是基于 MySQL 分支开发的，对一些 bug 修复和特性支持做得更好一些，我们在使用 KMAS 的过程中，">
<meta name="keywords" content="mariadb">
<meta property="og:type" content="article">
<meta property="og:title" content="MariaDB 的安装部署">
<meta property="og:url" content="http://yoursite.com/2017/11/17/安装 MariaDB/index.html">
<meta property="og:site_name" content="ITSYC&#39;s Blog">
<meta property="og:description" content="MySQL 的版本选择及安装部署KMAS 前后端均采用 MySQL 协议实现，由于 MySQL 及 MariaDB 均是用 MySQL 协议实现的。因此，这两个数据库都可以使用，且使用上无差别。除配置及一些特殊特性外，MySQL 和 MariaDB 基本可以互相替换。 由于 MariaDB 是基于 MySQL 分支开发的，对一些 bug 修复和特性支持做得更好一些，我们在使用 KMAS 的过程中，">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2017/11/17/安装%20MariaDB/install_mysql_succ.png">
<meta property="og:updated_time" content="2017-11-30T13:19:46.180Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MariaDB 的安装部署">
<meta name="twitter:description" content="MySQL 的版本选择及安装部署KMAS 前后端均采用 MySQL 协议实现，由于 MySQL 及 MariaDB 均是用 MySQL 协议实现的。因此，这两个数据库都可以使用，且使用上无差别。除配置及一些特殊特性外，MySQL 和 MariaDB 基本可以互相替换。 由于 MariaDB 是基于 MySQL 分支开发的，对一些 bug 修复和特性支持做得更好一些，我们在使用 KMAS 的过程中，">
<meta name="twitter:image" content="http://yoursite.com/2017/11/17/安装%20MariaDB/install_mysql_succ.png">



  <link rel="alternate" href="/atom.xml" title="ITSYC's Blog" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://yoursite.com/2017/11/17/安装 MariaDB/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>MariaDB 的安装部署 | ITSYC's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ITSYC's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Thoughts on life and code</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/17/安装 MariaDB/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yang Chuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ITSYC's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MariaDB 的安装部署

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-17 20:19:34" itemprop="dateCreated datePublished" datetime="2017-11-17T20:19:34+08:00">2017-11-17</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2017-11-30 21:19:46" itemprop="dateModified" datetime="2017-11-30T21:19:46+08:00">2017-11-30</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="MySQL-的版本选择及安装部署"><a href="#MySQL-的版本选择及安装部署" class="headerlink" title="MySQL 的版本选择及安装部署"></a>MySQL 的版本选择及安装部署</h1><p>KMAS 前后端均采用 MySQL 协议实现，由于 MySQL 及 MariaDB 均是用 MySQL 协议实现的。因此，这两个数据库都可以使用，且使用上无差别。除配置及一些特殊特性外，MySQL 和 MariaDB 基本可以互相替换。</p>
<p>由于 MariaDB 是基于 MySQL 分支开发的，对一些 bug 修复和特性支持做得更好一些，我们在使用 KMAS 的过程中，比较推荐使用 MariaDB。</p>
<a id="more"></a>
<h2 id="版本选取"><a href="#版本选取" class="headerlink" title="版本选取"></a>版本选取</h2><ul>
<li>MySQL: 5.7.x —&gt; 5.7.16(current)</li>
<li><p>MariaDB: 10.1.x —&gt; 10.1.19(current)  <strong>推荐！</strong></p>
<ul>
<li>MariaDB 10.1 版本是基于 MySQL 5.7 版本开发的</li>
</ul>
</li>
<li><p>MySQL JDBC: 5.1.40</p>
</li>
</ul>
<p><strong>为什么是选取 MySQL 5.7.x 和 MariaDB 10.1.x 版本？</strong><br>目前 MySQL 5.7.x 已经是一个可以稳定使用的版本，且功能较完善，性能相对以前版本有较大的提升。而，MariaDB 10.1.x 版本是基于 MySQL 5.7.x 分支改造的，两者基本可以互相替换。而原来的 MySQL 5.6 版本和 MariaDB 10.0 版本是一个过渡版本，没有比较好的解决性能问题。因此不推荐这个版本。</p>
<p><strong>以下的安装过程均是基于 MariaDB 10.1.x 版本编写的，如需替换成其他版本，请再借鉴其他介绍文档！</strong></p>
<h2 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h2><h3 id="系统版本及安装介质"><a href="#系统版本及安装介质" class="headerlink" title="系统版本及安装介质"></a>系统版本及安装介质</h3><p>本文档采用编译源码安装，并且安装在 CentOS 6.4 系统上，其他版本或系统，本章节内容有一定参考价值，请结合官方安装文档。</p>
<ul>
<li>安装宿主系统：CentOS 6.4 x86_64(amd64)</li>
<li>MariaDB：10.1.19</li>
</ul>
<h3 id="下载-MariaDB-安装介质"><a href="#下载-MariaDB-安装介质" class="headerlink" title="下载 MariaDB 安装介质"></a>下载 MariaDB 安装介质</h3><p>从<a href="https://downloads.mariadb.org/mariadb/10.1.19/" target="_blank" rel="noopener">官网</a> 下载 MariaDB 的安装介质，选择版本为 10.1.x 的，x 为小版本号，建议选择较高的。请勿选择 10.2.x 或者 10.0.x 版本，这个是大版本的变更，其功能和安装、配置等可能存在差异。</p>
<p>以下安装说明均以下载的 mariadb-10.1.19-linux-x86_64.tar.gz 包为例，安装过程中，请自行根据具体的包名和版本做适当调整。</p>
<h3 id="安装-MariaDB-服务"><a href="#安装-MariaDB-服务" class="headerlink" title="安装 MariaDB 服务"></a>安装 MariaDB 服务</h3><p><code>mariadb-10.1.19-linux-x86_64.tar.gz</code> 包为 MariaDB 的二进制包，基本是解压即可使用，以下内容主要是配置一些环境信息和开机启动脚本。</p>
<p>将 .tar.gz 包上传至需要安装的服务器，并解压（建议将其解压到 <code>/opt</code> 目录下，并命名为 <code>mariadb</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cp ./mariadb-10.1.19-linux-x86_64.tar.gz /opt/mariadb-10.1.19-linux-x86_64.tar.gz</span><br><span class="line"># cd /opt</span><br><span class="line"># tar -zxvf mariadb-10.1.19-linux-x86_64.tar.gz</span><br><span class="line"># mv mariadb-10.1.19-linux-x86_64 mariadb</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong> <code>/opt</code> 目录下操作需要 root 权限。</p>
<p><strong>创建用户组及用户</strong></p>
<p>运行 MySQL 服务时，建议其数据权限指定为 mysql 用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># groupadd mysql</span><br><span class="line"># useradd -g mysql mysql</span><br><span class="line"># passwd mysql</span><br><span class="line">New password:    # 输入 mysql 用户密码</span><br><span class="line">Retype new password:   # 再次输入 mysql 用户密码</span><br></pre></td></tr></table></figure>
<p><strong>将 MariaDB 的运行脚本添加到环境变量</strong><br>修改 mysql 用户的 <code>~/.bash_profile</code>，添加 <code>/opt/mariadb/bin</code> 到 $PATH 变量里面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ su - mysql</span><br><span class="line">$ vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line"># 在最后添加一下内容</span><br><span class="line">PATH=$PATH:/opt/mariadb/bin:/opt/mariadb/scripts</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>
<p>保存退出后执行 <code>source ~/.bash_profile</code> 重新加载当前 shell 变量。</p>
<h3 id="配置数据库实例参数"><a href="#配置数据库实例参数" class="headerlink" title="配置数据库实例参数"></a>配置数据库实例参数</h3><p>安装完成 MariaDB 服务后，需要初始化数据库实例才能正常运行，以下内容仅以在一台服务器上安装一个 MySQL 实例为例子编写，对于需要在一台服务器上安装多个 MySQL 实例请参考相关内容。</p>
<p>把 /opt/mariadb/support-files 下的 my-large.cnf 复制到 /etc 目录下，并改为 my.cnf。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cp /opt/mariadb/support-files/my-large.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>修改 /etc/my.cnf 文件内容为以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld_multi]</span><br><span class="line">mysqld=/opt/mariadb/bin/mysqld_safe</span><br><span class="line">mysqladmin=/opt/mariadb/bin/mysqladmin</span><br><span class="line">user=mysql</span><br><span class="line">log=/var/log/mysql/multi.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># tmp for mysql load data infile,load finish ,need to set to 1</span><br><span class="line">#innodb_doublewrite=0</span><br><span class="line">innodb_doublewrite</span><br><span class="line"></span><br><span class="line">#**********************Server**************************</span><br><span class="line">#******server start related</span><br><span class="line">optimizer_switch=&apos;index_condition_pushdown=on&apos;</span><br><span class="line">optimizer_switch=&apos;mrr=on&apos;</span><br><span class="line">optimizer_switch=&apos;mrr_sort_keys=on&apos;</span><br><span class="line">optimizer_switch=&apos;mrr_cost_based=off&apos;</span><br><span class="line">mrr_buffer_size=64M</span><br><span class="line">optimizer_switch=&apos;join_cache_incremental=on&apos;</span><br><span class="line">optimizer_switch=&apos;join_cache_hashed=on&apos;</span><br><span class="line">optimizer_switch=&apos;join_cache_bka=on&apos;</span><br><span class="line">join_cache_level=2  #4 for hash join</span><br><span class="line">join_buffer_size=64M</span><br><span class="line">join_buffer_space_limit=64M</span><br><span class="line">userstat = 1</span><br><span class="line"></span><br><span class="line">user=mysql</span><br><span class="line">bind-address=0.0.0.0</span><br><span class="line">port=3306</span><br><span class="line">#port-open-timeout=</span><br><span class="line">server-id=90743306</span><br><span class="line">gtid-domain-id=7406</span><br><span class="line">#chroot</span><br><span class="line">#init-file=file_name</span><br><span class="line">#core-file=OFF</span><br><span class="line">#skip-grant-tables</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******location</span><br><span class="line">basedir=/opt/mariadb/</span><br><span class="line">plugin-dir= /opt/mariadb/lib/plugin</span><br><span class="line">datadir=/home/mysql/mysql3306/data</span><br><span class="line">pid-file=/home/mysql/mysql3306/mysql.pid</span><br><span class="line">socket=/tmp/mysql3306.sock</span><br><span class="line">tmpdir=/home/mysql/mysql3306/tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******security</span><br><span class="line">#secure-auth</span><br><span class="line">safe-user-create</span><br><span class="line">#skip-show-database</span><br><span class="line">max_user_connections=2980</span><br><span class="line">max_connect_errors=100000</span><br><span class="line">#secure-file-priv=path</span><br><span class="line">#max_prepared_stmt_count=</span><br><span class="line">#skip-ssl</span><br><span class="line">#ssl-ca=file_name</span><br><span class="line">#ssl-capath=directory_name</span><br><span class="line">#ssl-cert=file_name</span><br><span class="line">#ssl-cipher=cipher_list</span><br><span class="line">#ssl-key=file_name</span><br><span class="line"># extra-max-connections=10</span><br><span class="line"></span><br><span class="line">#******features</span><br><span class="line">default-storage-engine=InnoDB</span><br><span class="line">#ansi</span><br><span class="line">#sql-mode=</span><br><span class="line">#auto_increment_increment=1</span><br><span class="line">#auto_increment_offset=1</span><br><span class="line">#div_precision_increment=4</span><br><span class="line">event-scheduler=on</span><br><span class="line">#skip-event-scheduler</span><br><span class="line">#flush</span><br><span class="line">#flush_time=</span><br><span class="line">#old</span><br><span class="line">#old-alter-table</span><br><span class="line">#old-style-user-limits</span><br><span class="line">partition</span><br><span class="line">#skip-partition</span><br><span class="line">#plugin_dir=</span><br><span class="line">#plugin-load=plugin_list</span><br><span class="line">#symbolic-links</span><br><span class="line">#skip-symbolic-links</span><br><span class="line">lock_wait_timeout=600</span><br><span class="line">#sync_frm</span><br><span class="line">#temp-pool</span><br><span class="line">#updatable_views_with_limit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******function</span><br><span class="line">#allow-suspicious-udfs</span><br><span class="line">#des-key-file=file_name</span><br><span class="line">group_concat_max_len=10240</span><br><span class="line">#max_long_data_size=</span><br><span class="line">sysdate-is-now</span><br><span class="line">#default_week_format=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******character set&amp;time zone etc..</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_bin</span><br><span class="line">#character-set-client-handshake</span><br><span class="line">#skip-character-set-client-handshake</span><br><span class="line">character-set-filesystem=utf8</span><br><span class="line">#character-sets-dir=</span><br><span class="line">#lower_case_file_system</span><br><span class="line">lower_case_table_names=1</span><br><span class="line">#lc-messages=</span><br><span class="line">#lc-messages-dir=</span><br><span class="line">default-time-zone=&apos;+8:00&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******buffer&amp;cache</span><br><span class="line">#memlock</span><br><span class="line">#large-pages</span><br><span class="line">join_buffer_size=128K</span><br><span class="line">sort_buffer_size=8m</span><br><span class="line">table_open_cache=1024</span><br><span class="line">table_definition_cache=1024</span><br><span class="line">#range_alloc_block_size=</span><br><span class="line">#query_prealloc_size=</span><br><span class="line">#query_alloc_block_size=</span><br><span class="line">#stored_program_cache=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****query cache</span><br><span class="line">query_cache_type=0</span><br><span class="line">query_cache_size=0</span><br><span class="line">#query_cache_min_res_unit=</span><br><span class="line">query_cache_limit=0</span><br><span class="line">#query_cache_wlock_invalidate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******thread&amp;connection</span><br><span class="line">thread_handling=pool-of-threads</span><br><span class="line">thread_pool_stall_limit=200</span><br><span class="line">thread_pool_size=16</span><br><span class="line"># sqlasyn=1</span><br><span class="line"># extra-max-connection=20</span><br><span class="line">#slow_launch_time=</span><br><span class="line">#init_connect=</span><br><span class="line">back_log=300</span><br><span class="line">thread_cache_size=512</span><br><span class="line">max_connections=3000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******temptable</span><br><span class="line">#big-tables</span><br><span class="line">#tmp_table_size=64m</span><br><span class="line">tmp_table_size=128m  #for mairadb</span><br><span class="line">#max_heap_table_size=64m</span><br><span class="line">max_heap_table_size=128m #for mairadb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******network</span><br><span class="line">#skip-networking</span><br><span class="line">skip-name-resolve</span><br><span class="line">#skip-host-cache</span><br><span class="line">net_buffer_length=8k</span><br><span class="line">max_allowed_packet=64m</span><br><span class="line">connect_timeout=10</span><br><span class="line">wait_timeout=1800</span><br><span class="line">interactive_timeout=1800</span><br><span class="line">net_read_timeout=3 #set to 10 if across IDC</span><br><span class="line">net_write_timeout=6 #set to 10 if across IDC</span><br><span class="line">net_retry_count=2 #set to 5 if across IDC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****profile&amp;optimizer</span><br><span class="line">#profiling</span><br><span class="line">profiling_history_size=5</span><br><span class="line">#optimizer_prune_level=</span><br><span class="line">#optimizer_search_depth=</span><br><span class="line">#optimizer_switch=</span><br><span class="line">#max_seeks_for_key=1000</span><br><span class="line">max_length_for_sort_data=4096</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******limitation</span><br><span class="line">#max_error_count=</span><br><span class="line">#max_join_size=</span><br><span class="line">#max_sort_length=</span><br><span class="line">#max_sp_recursion_depth=</span><br><span class="line">open-files-limit=8192</span><br><span class="line">#thread_stack=512k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#**********************Logs****************************</span><br><span class="line">log-output=FILE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****error log</span><br><span class="line">log-error=/home/mysql/mysql3306/logs/error3306.log</span><br><span class="line">#log-warnings</span><br><span class="line">skip-log-warnings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****slow log</span><br><span class="line">slow-query-log</span><br><span class="line">slow_query_log_file=/home/mysql/mysql3306/logs/slow3306.log</span><br><span class="line">long_query_time=2</span><br><span class="line">#log-queries-not-using-indexes</span><br><span class="line">log-slow-admin-statements</span><br><span class="line">log-slow-slave-statements</span><br><span class="line">#min-examined-row-limit=10</span><br><span class="line"></span><br><span class="line">log_slow_verbosity=&apos;Query_plan,Innodb&apos;  #for mariadb</span><br><span class="line"></span><br><span class="line">#*****general log</span><br><span class="line">#general-log</span><br><span class="line">#general_log_file=/home/mysql/mysql3306/logs/query.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#**********************Replication*********************</span><br><span class="line">#skip-slave-start</span><br><span class="line">#read_only</span><br><span class="line">slave_parallel_threads=16</span><br><span class="line">#init_slave=</span><br><span class="line">master-info-file=master.info</span><br><span class="line">#sync_master_info=1000</span><br><span class="line">#slave_type_conversions=</span><br><span class="line">#slave_transaction_retries=</span><br><span class="line">#slave_exec_mode=</span><br><span class="line">#slave-skip-errors=1062 1064 1146 #only for 216</span><br><span class="line">slave-load-tmpdir=/home/mysql/mysql3306/tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******network</span><br><span class="line">#slave_compressed_protocol #for RBR</span><br><span class="line">#slave-max-allowed-packet=</span><br><span class="line">slave-net-timeout=30</span><br><span class="line">#master-retry-count=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******report</span><br><span class="line">#show-slave-auth-info</span><br><span class="line">#report-host=</span><br><span class="line">#report-password=</span><br><span class="line">#report-port=</span><br><span class="line">#report-user=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****binlog</span><br><span class="line">log-bin=/home/mysql/mysql3306/binlog/mysql-bin</span><br><span class="line">log-bin-index=/home/mysql/mysql3306/binlog/mysql-bin.index</span><br><span class="line">sync_binlog=1         #close for sas</span><br><span class="line">#binlog-format=MIXED</span><br><span class="line">binlog-format=row</span><br><span class="line">max_binlog_size=512m</span><br><span class="line">expire_logs_days=7</span><br><span class="line">binlog_cache_size=256K</span><br><span class="line">#max_binlog_cache_size=256m #increase this for RBR</span><br><span class="line">max_binlog_cache_size=1024m</span><br><span class="line">binlog_stmt_cache_size=32k</span><br><span class="line">max_binlog_stmt_cache_size=256m</span><br><span class="line">binlog-row-event-max-size=256m</span><br><span class="line">#log-short-format</span><br><span class="line">#log_slave_updates</span><br><span class="line">log-bin-trust-function-creators</span><br><span class="line">#binlog_direct_non_transactional_updates</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****relaylog</span><br><span class="line">relay-log=relay-bin</span><br><span class="line">relay-log-index=relay-bin.index</span><br><span class="line">relay-log-info-file=relay-log.info</span><br><span class="line">#sync_relay_log=1000</span><br><span class="line">#sync_relay_log_info=1000</span><br><span class="line">#max_relay_log_size=</span><br><span class="line">relay_log_space_limit=100G</span><br><span class="line">relay_log_purge=1</span><br><span class="line">#relay_log_recovery</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******filter</span><br><span class="line">#binlog-do-db=</span><br><span class="line">#binlog-ignore-db=</span><br><span class="line">#replicate-do-db=</span><br><span class="line">#replicate-ignore-db=</span><br><span class="line">#replicate-do-table=</span><br><span class="line">#replicate-ignore-table=</span><br><span class="line">#replicate-wild-do-table=</span><br><span class="line">#replicate-wild-ignore-table=</span><br><span class="line">#replicate-same-server-id</span><br><span class="line">#replicate-rewrite-db=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#**********************InnoDB**************************</span><br><span class="line">innodb_data_home_dir=/home/mysql/mysql3306/data</span><br><span class="line">innodb_data_file_path=ibdata1:1000M:autoextend</span><br><span class="line">innodb_log_group_home_dir=/home/mysql/mysql3306/data</span><br><span class="line">innodb_log_files_in_group=4</span><br><span class="line">innodb_log_file_size=1000M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****feature</span><br><span class="line">innodb_open_files=4096</span><br><span class="line">innodb_change_buffering=inserts</span><br><span class="line">innodb_adaptive_hash_index=ON</span><br><span class="line">innodb_autoinc_lock_mode=1</span><br><span class="line">#innodb_large_prefix</span><br><span class="line">#innodb_strict_mode</span><br><span class="line">#innodb_use_sys_malloc=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******buffer&amp;cache</span><br><span class="line">innodb_buffer_pool_size=100G  #for mariadb</span><br><span class="line">innodb_buffer_pool_instances=4</span><br><span class="line">innodb_max_dirty_pages_pct=50</span><br><span class="line">innodb_old_blocks_pct=25</span><br><span class="line">innodb_old_blocks_time=3000</span><br><span class="line">innodb_additional_mem_pool_size=32m</span><br><span class="line">innodb_log_buffer_size=8m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******IO</span><br><span class="line">innodb_flush_method=O_DIRECT</span><br><span class="line">innodb_use_native_aio</span><br><span class="line">innodb_adaptive_flushing</span><br><span class="line">innodb_flush_log_at_trx_commit=1</span><br><span class="line">innodb_io_capacity=1200</span><br><span class="line">innodb_read_io_threads=4</span><br><span class="line">innodb_write_io_threads=4</span><br><span class="line">innodb_read_ahead_threshold=56</span><br><span class="line">#innodb_doublewrite</span><br><span class="line">innodb_purge_threads=1</span><br><span class="line">innodb_purge_batch_size=20</span><br><span class="line">#innodb_max_purge_lag=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*****fileformat</span><br><span class="line">innodb_file_per_table</span><br><span class="line">innodb_autoextend_increment=32</span><br><span class="line">innodb_file_format=Barracuda</span><br><span class="line">#innodb_file_format_check=</span><br><span class="line">#innodb_file_format_max=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******static&amp;status</span><br><span class="line">#innodb_stats_on_metadata</span><br><span class="line">innodb_stats_on_metadata=0  #for mariadb</span><br><span class="line">innodb_stats_sample_pages=32</span><br><span class="line">innodb_stats_method=nulls_unequal</span><br><span class="line">#timed_mutexes</span><br><span class="line">#innodb-status-file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******recovery&amp;related</span><br><span class="line">innodb_fast_shutdown=1</span><br><span class="line">#innodb_force_load_corrupted</span><br><span class="line">#innodb_force_recovery=</span><br><span class="line">innodb_checksums</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******transaction,lock,concurrency,rollback</span><br><span class="line">autocommit=1</span><br><span class="line">#transaction-isolation=REPEATABLE-READ</span><br><span class="line">transaction-isolation=READ-COMMITTED #for mariadb</span><br><span class="line">#transaction_prealloc_size=64k</span><br><span class="line">#transaction_alloc_block_size=64k</span><br><span class="line">completion_type=NO_CHAIN</span><br><span class="line">innodb_support_xa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">innodb_table_locks</span><br><span class="line">#innodb_lock_wait_timeout=30</span><br><span class="line">innodb_lock_wait_timeout=45 # for mariadb setup</span><br><span class="line">#innodb_locks_unsafe_for_binlog</span><br><span class="line">innodb_spin_wait_delay=12</span><br><span class="line">innodb_sync_spin_loops=90</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">innodb_commit_concurrency=0</span><br><span class="line">innodb_thread_concurrency=32       #at least equal cpu nums</span><br><span class="line">#innodb_concurrency_tickets=500</span><br><span class="line">#innodb_replication_delay=0</span><br><span class="line">#innodb_thread_sleep_delay=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#innodb_rollback_on_timeout</span><br><span class="line">#innodb_rollback_segments=128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#**********************MyISAM**************************</span><br><span class="line">#******feature</span><br><span class="line">#myisam_data_pointer_size=</span><br><span class="line">#myisam_use_mmap</span><br><span class="line">#keep_files_on_create</span><br><span class="line">myisam-block-size=4096</span><br><span class="line">delay-key-write=on</span><br><span class="line">#preload_buffer_size</span><br><span class="line">myisam_stats_method=nulls_unequal</span><br><span class="line">#myisam-recover-options=OFF</span><br><span class="line">myisam_repair_threads=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******buffer&amp;cache</span><br><span class="line">key_buffer_size=2048M</span><br><span class="line">key_cache_block_size=4096</span><br><span class="line">key_cache_age_threshold=300</span><br><span class="line">key_cache_division_limit=20</span><br><span class="line">#read_buffer_size=1m</span><br><span class="line">#read_rnd_buffer_size=2m</span><br><span class="line">read_buffer_size=4m     #for mariadb</span><br><span class="line">read_rnd_buffer_size=8m #for mariadb</span><br><span class="line"></span><br><span class="line">myisam_sort_buffer_size=32m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#*******delayed insert</span><br><span class="line">#delayed_queue_size=</span><br><span class="line">#max_delayed_threads=</span><br><span class="line">#delayed_insert_limit=</span><br><span class="line">#delayed_insert_timeout=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******fulltext</span><br><span class="line">#ft_boolean_syntax=</span><br><span class="line">#ft_max_word_len=</span><br><span class="line">#ft_min_word_len=</span><br><span class="line">#ft_query_expansion_limit=</span><br><span class="line">#ft_stopword_file=file_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******limitation</span><br><span class="line">bulk_insert_buffer_size=8m</span><br><span class="line">myisam_max_sort_file_size=10G</span><br><span class="line">#myisam_mmap_size=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#******lock&amp;concurrency</span><br><span class="line">#external-locking</span><br><span class="line">skip-external-locking</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">concurrent_insert=AUTO</span><br><span class="line">#skip-concurrent-insert</span><br><span class="line">max_write_lock_count=10000</span><br><span class="line">#low-priority-updates</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#********************performance_schema****************</span><br><span class="line">performance_schema=1</span><br><span class="line">#performance_schema_events_waits_history_long_size=</span><br><span class="line">#performance_schema_events_waits_history_size=</span><br><span class="line">#performance_schema_max_cond_classes=</span><br><span class="line">#performance_schema_max_cond_instances=</span><br><span class="line">#performance_schema_max_file_classes=</span><br><span class="line">#performance_schema_max_file_handles=</span><br><span class="line">#performance_schema_max_file_instances=</span><br><span class="line">#performance_schema_max_mutex_classes=</span><br><span class="line">#performance_schema_max_mutex_instances=</span><br><span class="line">#performance_schema_max_rwlock_classes=</span><br><span class="line">#performance_schema_max_rwlock_instances=</span><br><span class="line">#performance_schema_max_table_handles=</span><br><span class="line">#performance_schema_max_table_instances=</span><br><span class="line">#performance_schema_max_thread_classes=</span><br><span class="line">#performance_schema_max_thread_instances=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#**************************federated********************</span><br><span class="line"># federated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 2G</span><br><span class="line">log-error=/home/mysql/mysql3306/logs/dump3306.log</span><br><span class="line">net_buffer_length=8k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">no-beep</span><br><span class="line">default-character-set = utf8</span><br><span class="line">socket=/tmp/mysql3306.sock</span><br><span class="line"># prompt=&quot;\\U : \\d \\R:\\m:\\s&gt; &quot;</span><br><span class="line"># tee=&quot;/home/mysql/mysql3306/logs/audit.log&quot;</span><br><span class="line"># pager=&quot;less -i -n -S&quot;</span><br><span class="line">net_buffer_length=64K</span><br><span class="line">unbuffered</span><br><span class="line"></span><br><span class="line">[mysqladmin]</span><br><span class="line">default-character-set = utf8</span><br><span class="line">socket=/tmp/mysql3306.sock</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer = 512M</span><br><span class="line">sort_buffer_size = 512M</span><br><span class="line">read_buffer = 8M</span><br><span class="line">write_buffer = 8M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">open-files-limit = 8192</span><br><span class="line">ledir=/opt/mariadb/bin</span><br></pre></td></tr></table></figure>
<p>以上配置将 MySQL 实例初始化到 <code>/home/mysql/mysql3306</code> 目录下，请安装时根据实际的路径修改上面配置文件中的路径，涉及配置项如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">datadir=/home/mysql/mysql3306/data</span><br><span class="line">pid-file=/home/mysql/mysql3306/mysql.pid</span><br><span class="line">tmpdir=/home/mysql/mysql3306/tmp</span><br><span class="line">log-error=/home/mysql/mysql3306/logs/error3306.log</span><br><span class="line">slow_query_log_file=/home/mysql/mysql3306/logs/slow3306.log</span><br><span class="line">#general_log_file=/home/mysql/mysql3306/logs/query.log</span><br><span class="line">slave-load-tmpdir=/home/mysql/mysql3306/tmp</span><br><span class="line">log-bin=/home/mysql/mysql3306/binlog/mysql-bin</span><br><span class="line">log-bin-index=/home/mysql/mysql3306/binlog/mysql-bin.index</span><br><span class="line">innodb_data_home_dir=/home/mysql/mysql3306/data</span><br><span class="line">innodb_log_group_home_dir=/home/mysql/mysql3306/data</span><br><span class="line">log-error=/home/mysql/mysql3306/logs/dump3306.log</span><br><span class="line">ledir=/opt/mariadb/bin</span><br></pre></td></tr></table></figure>
<p>其他参数的修改：</p>
<ul>
<li><code>server-id=90883306</code>   命名规则：机器 ip 后两个 + 端口</li>
<li><code>gtid-domain-id=8890926</code>   一主两从 ip 的后一位 + 端口后一位</li>
<li><code>innodb_buffer_pool_size=100G</code>   单实例不超过机器内存的 80%，双实例加起来不超过机器内存的 80%</li>
<li><code>innodb_thread_concurrency=32</code>   小于等于 cpu 线程数</li>
<li><code>log_slave_updates</code>   一主一从关闭 log_slave_updates（即注释掉），一主两从开启 <code>log_slave_updates</code></li>
</ul>
<p><strong>初始化实例</strong></p>
<p>切换用户到 mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ su - mysql</span><br><span class="line">Password:</span><br></pre></td></tr></table></figure>
<p>创建需要的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /home/mysql/mysql3306/</span><br><span class="line">$ cd /home/mysql/mysql3306/ &amp;&amp; mkdir &#123;data,logs,binlog,tmp,bin&#125;</span><br></pre></td></tr></table></figure>
<p>运行一下命令进行初始化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$ mysql_install_db --basedir=/opt/mariadb/ --defaults-file=/etc/my.cnf --user=mysql</span><br><span class="line">Installing MariaDB/MySQL system tables in &apos;/home/mysql/mysql3306&apos; ...</span><br><span class="line">2016-12-12  9:12:48 139952692410208 [Note] /opt/mariadb/bin/mysqld (mysqld 10.1.19-MariaDB) starting as process 14731 ...</span><br><span class="line">OK</span><br><span class="line">Filling help tables...</span><br><span class="line">2016-12-12  9:12:54 140080526587744 [Note] /opt/mariadb/bin/mysqld (mysqld 10.1.19-MariaDB) starting as process 14763 ...</span><br><span class="line">OK</span><br><span class="line">Creating OpenGIS required SP-s...</span><br><span class="line">2016-12-12  9:12:59 140681527736160 [Note] /opt/mariadb/bin/mysqld (mysqld 10.1.19-MariaDB) starting as process 14795 ...</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">To start mysqld at boot time you have to copy</span><br><span class="line">support-files/mysql.server to the right place for your system</span><br><span class="line"></span><br><span class="line">PLEASE REMEMBER TO SET A PASSWORD FOR THE MariaDB root USER !</span><br><span class="line">To do so, start the server, then issue the following commands:</span><br><span class="line"></span><br><span class="line">&apos;/opt/mariadb/bin/mysqladmin&apos; -u root password &apos;new-password&apos;</span><br><span class="line">&apos;/opt/mariadb/bin/mysqladmin&apos; -u root -h 127.0.0.1 password &apos;new-password&apos;</span><br><span class="line"></span><br><span class="line">Alternatively you can run:</span><br><span class="line">&apos;/opt/mariadb/bin/mysql_secure_installation&apos;</span><br><span class="line"></span><br><span class="line">which will also give you the option of removing the test</span><br><span class="line">databases and anonymous user created by default.  This is</span><br><span class="line">strongly recommended for production servers.</span><br><span class="line"></span><br><span class="line">See the MariaDB Knowledgebase at http://mariadb.com/kb or the</span><br><span class="line">MySQL manual for more instructions.</span><br><span class="line"></span><br><span class="line">You can start the MariaDB daemon with:</span><br><span class="line">cd &apos;/opt/mariadb/&apos; ; /opt/mariadb/bin/mysqld_safe --datadir=&apos;/home/mysql/mysql3306/data&apos;</span><br><span class="line"></span><br><span class="line">You can test the MariaDB daemon with mysql-test-run.pl</span><br><span class="line">cd &apos;/opt/mariadb/mysql-test&apos; ; perl mysql-test-run.pl</span><br><span class="line"></span><br><span class="line">Please report any problems at http://mariadb.org/jira</span><br><span class="line"></span><br><span class="line">The latest information about MariaDB is available at http://mariadb.org/.</span><br><span class="line">You can find additional information about the MySQL part at:</span><br><span class="line">http://dev.mysql.com</span><br><span class="line">Support MariaDB development by buying support/new features from MariaDB</span><br><span class="line">Corporation Ab. You can contact us about this at sales@mariadb.com.</span><br><span class="line">Alternatively consider joining our community based development effort:</span><br><span class="line">http://mariadb.com/kb/en/contributing-to-the-mariadb-project/</span><br></pre></td></tr></table></figure>
<p>可以通过上面信息看到 OK。</p>
<p><img src="/2017/11/17/安装 MariaDB/./install_mysql_succ.png" alt=""></p>
<p>查询 <code>cat /home/mysql/mysql3306/logs/error3306.log</code> 日志，没有 <code>[ERROR]</code> 日志标识安装成功。</p>
<h3 id="启动-MariaDB-实例"><a href="#启动-MariaDB-实例" class="headerlink" title="启动 MariaDB 实例"></a>启动 MariaDB 实例</h3><p><strong>方式一：本文采用服务方式启动 MariaDB 服务。</strong></p>
<p>首先，需要拷贝配置脚本到服务启动目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cp /opt/mariab/support-files/mysql.server /etc/rc.d/init.d/mysqld</span><br><span class="line"># chmod +x /etc/rc.d/init.d/mysqld</span><br></pre></td></tr></table></figure>
<p>修改启动脚本内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/rc.d/init.d/mysqld</span><br><span class="line"></span><br><span class="line"># 修改 basedir= 及 datadir= 两个参数</span><br><span class="line">basedir=/opt/mariadb</span><br><span class="line">datadir=/home/mysql/mysql3306/data</span><br></pre></td></tr></table></figure>
<p>通过 service 启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ service mysqld start</span><br><span class="line">Starting MySQL.161212 10:02:09 mysqld_safe Logging to &apos;/home/mysql/mysql3306/logs/mysql_3306.err&apos;.</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ ps -ef|grep mysql</span><br><span class="line">mysql    24488     1  0 10:02 pts/1    00:00:00 /bin/sh /opt/mariadb/bin/mysqld_safe --datadir=/home/mysql/mysql3306/data --pid-file=/home/mysql/mysql3306/mysqld3306.pid</span><br><span class="line">mysql    25032 24488  0 10:02 pts/1    00:00:04 /opt/mariadb/bin/mysqld --basedir=/opt/mariadb/ --datadir=/home/mysql/mysql3306/data --plugin-dir=/opt/mariadb/lib/plugin --log-err</span><br><span class="line">or=/home/mysql/mysql3306/logs/mysql_3306.err --open-files-limit=8192 --pid-file=/home/mysql/mysql3306/mysqld3306.pid --socket=/tmp/mysql3306.sock --po</span><br><span class="line">rt=3306</span><br></pre></td></tr></table></figure>
<p><strong>方式二：采用 mysqld_safe 启动</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ mysqld_safe --defaults-file=/etc/my.cnf &amp;</span><br><span class="line"></span><br><span class="line">$ ps -ef|grep mysql</span><br><span class="line">mysql    24488     1  0 10:02 pts/1    00:00:00 /bin/sh /opt/mariadb/bin/mysqld_safe --datadir=/home/mysql/mysql3306/data --pid-file=/home/mysql/mysql3306/mysqld3306.pid</span><br><span class="line">mysql    25032 24488  0 10:02 pts/1    00:00:04 /opt/mariadb/bin/mysqld --basedir=/opt/mariadb/ --datadir=/home/mysql/mysql3306/data --plugin-dir=/opt/mariadb/lib/plugin --log-err</span><br><span class="line">or=/home/mysql/mysql3306/logs/mysql_3306.err --open-files-limit=8192 --pid-file=/home/mysql/mysql3306/mysqld3306.pid --socket=/tmp/mysql3306.sock --po</span><br><span class="line">rt=3306</span><br></pre></td></tr></table></figure>
<p>至此，MariaDB 的安装部署已经完成。</p>
<h3 id="配置-root-用户密码"><a href="#配置-root-用户密码" class="headerlink" title="配置 root 用户密码"></a>配置 root 用户密码</h3><p>启动服务成功后，MySQL 实例 root 用户的默认密码为空。<br>可以通过一下命令登录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -uroot -p  -S /tmp/mysql3306.sock</span><br><span class="line">Enter password:</span><br></pre></td></tr></table></figure>
<p><code>Enter password:</code> 处回车即可。</p>
<p>然后通过一下命令修改密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysqladmin -u root password &apos;new_password&apos;</span><br></pre></td></tr></table></figure>
<p><code>new_password</code> 处即为新密码，请修改后保存改密码，后续登录 root 用户需要输入此密码。</p>
<p>如果需要修改新密码，可以先登录到 mysql 中，执行以下命令进行修改（新密码为：<code>Aa123456</code>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; update mysql.user set password=password(&apos;Aa123456&apos;) where user=&apos;root&apos;;</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br></pre></td></tr></table></figure>
<h3 id="配置-root-用户远程访问"><a href="#配置-root-用户远程访问" class="headerlink" title="配置 root 用户远程访问"></a>配置 root 用户远程访问</h3><p>默认安装的 MySQL 实例 root 用户只有本地访问权限，需要通过修改 <code>mysql.user</code> 表，给 root 用户授权。<br>执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;root123&apos; WITH GRANT OPTION;</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br></pre></td></tr></table></figure>
<h3 id="遇到问题-1："><a href="#遇到问题-1：" class="headerlink" title="遇到问题 1："></a>遇到问题 1：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">$ mysql_install_db --basedir=/opt/mariadb/ --defaults-file=/etc/my.cnf                                                            [95/19157]</span><br><span class="line">Installing MariaDB/MySQL system tables in &apos;/home/mysql/mysql3306&apos; ...</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] Using unique option prefix &apos;extra-max-connection&apos; is error-prone and can break in the future. Please use the full name &apos;extra_max_conne</span><br><span class="line">ctions&apos; instead.</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] /opt/mariadb//bin/mysqld (mysqld 10.1.19-MariaDB) starting as process 14447 ...</span><br><span class="line"></span><br><span class="line">Installation of system tables failed!  Examine the logs in</span><br><span class="line">/home/mysql/mysql3306 for more information.</span><br><span class="line"></span><br><span class="line">The problem could be conflicting information in an external</span><br><span class="line">my.cnf files. You can ignore these by doing:</span><br><span class="line"></span><br><span class="line">    shell&gt; /opt/mariadb//scripts/scripts/mysql_install_db --defaults-file=~/.my.cnf</span><br><span class="line"></span><br><span class="line">You can also try to start the mysqld daemon with:</span><br><span class="line"></span><br><span class="line">    shell&gt; /opt/mariadb//bin/mysqld --skip-grant --general-log &amp;</span><br><span class="line"></span><br><span class="line">and use the command line tool /opt/mariadb//bin/mysql</span><br><span class="line">to connect to the mysql database and look at the grant tables:</span><br><span class="line"></span><br><span class="line">    shell&gt; /opt/mariadb//bin/mysql -u root mysql</span><br><span class="line">    mysql&gt; show tables;</span><br><span class="line"></span><br><span class="line">Try &apos;mysqld --help&apos; if you have problems with paths.  Using</span><br><span class="line">--general-log gives you a log in /home/mysql/mysql3306 that may be helpful.</span><br><span class="line"></span><br><span class="line">The latest information about mysql_install_db is available at</span><br><span class="line">https://mariadb.com/kb/en/installing-system-tables-mysql_install_db</span><br><span class="line">MariaDB is hosted on launchpad; You can find the latest source and</span><br><span class="line">email lists at http://launchpad.net/maria</span><br><span class="line"></span><br><span class="line">Please check all of the above before submitting a bug report</span><br><span class="line">at http://mariadb.org/jira</span><br><span class="line"></span><br><span class="line">$ cat /home/mysql/mysql3306/logs/error3306.log</span><br><span class="line">2016-12-12 08:59:36 7f800a664760 InnoDB: Warning: Using innodb_additional_mem_pool_size is DEPRECATED. This option may be removed in future releases, together with the option in$</span><br><span class="line">odb_use_sys_malloc and with the InnoDB&apos;s internal memory allocator.</span><br><span class="line">innodb_open_files should not be greater than the open_files_limit.</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Using mutexes to ref count buffer pool pages</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: GCC builtin __sync_synchronize() is used for memory barrier</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Compressed tables use zlib 1.2.3</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Using Linux native AIO</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Using SSE crc32 instructions</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Initializing buffer pool, size = 512.0M</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Completed initialization of buffer pool</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: The first specified data file /home/mysql/mysql3306/ibdata1 did not exist: a new database to be created!</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Setting file /home/mysql/mysql3306/ibdata1 size to 128 MB</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Database physically writes the file full: wait...</span><br><span class="line">InnoDB: Progress in MB: 100</span><br><span class="line">2016-12-12  8:59:36 140187907016544 [Note] InnoDB: Setting log file /home/mysql/mysql3306/ib_logfile101 size to 1000 MB</span><br><span class="line">InnoDB: Progress in MB: 100 200 300 400 500 600 700 800 900 1000</span><br><span class="line">2016-12-12  8:59:38 140187907016544 [Note] InnoDB: Setting log file /home/mysql/mysql3306/ib_logfile1 size to 1000 MB</span><br><span class="line">InnoDB: Progress in MB: 100 200 300 400 500 600 700 800 900 1000</span><br><span class="line">2016-12-12  8:59:39 140187907016544 [Note] InnoDB: Setting log file /home/mysql/mysql3306/ib_logfile2 size to 1000 MB</span><br><span class="line">InnoDB: Progress in MB: 100 200 300 400 500 600 700 800 900 1000</span><br><span class="line">2016-12-12  8:59:40 140187907016544 [Note] InnoDB: Setting log file /home/mysql/mysql3306/ib_logfile3 size to 1000 MB</span><br><span class="line">InnoDB: Progress in MB: 100 200 300 400 500 600 700 8002016-12-12 08:59:41 7f800a664760 InnoDB: Error: Write to file /home/mysql/mysql3306/ib_logfile3 failed at offset 894435</span><br><span class="line">328.</span><br><span class="line">InnoDB: 1048576 bytes should have been written, only 126976 were written.</span><br><span class="line">InnoDB: Operating system error number 28.</span><br><span class="line">InnoDB: Check that your OS and file system support files of this size.</span><br><span class="line">InnoDB: Check also that the disk is not full or a disk quota exceeded.</span><br><span class="line">InnoDB: Error number 28 means &apos;No space left on device&apos;.</span><br><span class="line">InnoDB: Some operating system error numbers are described at</span><br><span class="line">InnoDB: http://dev.mysql.com/doc/refman/5.6/en/operating-system-error-codes.html</span><br><span class="line">2016-12-12  8:59:41 140187907016544 [ERROR] InnoDB: Cannot set log file /home/mysql/mysql3306/ib_logfile3 to size 1000 MB</span><br><span class="line">2016-12-12  8:59:41 140187907016544 [ERROR] Plugin &apos;InnoDB&apos; init function returned error.</span><br><span class="line">2016-12-12  8:59:41 140187907016544 [ERROR] Plugin &apos;InnoDB&apos; registration as a STORAGE ENGINE failed.</span><br><span class="line">2016-12-12  8:59:41 140187907016544 [ERROR] Unknown/unsupported storage engine: InnoDB</span><br><span class="line">2016-12-12  8:59:41 140187907016544 [ERROR] Aborting</span><br><span class="line"></span><br><span class="line">2016-12-12  8:59:41 140186063206144 [Warning] mysqld: Disk is full writing &apos;/home/mysql/mysql3306/aria_log.00000001&apos; (Errcode: 28 &quot;No space left on device&quot;). Waiting for some</span><br><span class="line">one to free space... (Expect up to 60 secs delay for server to continue after freeing disk space)</span><br><span class="line">2016-12-12  8:59:41 140186063206144 [Warning] mysqld: Retry in 60 secs. Message reprinted in 600 secs</span><br></pre></td></tr></table></figure>
<p>修改 /etc/my.cnf<br>改小：innodb_log_file_size=128M</p>
<p>删除 /home/myql/mysql3306 目录后重新初始化目录，并重新执行 mysql_install_db 命令</p>
<h3 id="遇到问题-2："><a href="#遇到问题-2：" class="headerlink" title="遇到问题 2："></a>遇到问题 2：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql_install_db --basedir=/opt/mariadb/ --defaults-file=/etc/my.cnf</span><br><span class="line"></span><br><span class="line">WARNING: The host &apos;vagrant-centos64.vagrantup.com&apos; could not be looked up with resolveip.</span><br><span class="line">This probably means that your libc libraries are not 100 % compatible</span><br><span class="line">with this binary MariaDB version. The MariaDB daemon, mysqld, should work</span><br><span class="line">normally with the exception that host name resolving will not work.</span><br><span class="line">This means that you should use IP addresses instead of hostnames</span><br><span class="line">when specifying MariaDB privileges !</span><br></pre></td></tr></table></figure>
<p><code>vagrant-centos64.vagrantup.com</code> 是本机的 hostname，可以通过 <code>hostname</code> 命令查看当前主机名<br>修改 /etc/hosts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/hosts</span><br><span class="line"></span><br><span class="line"># 添加以下内容</span><br><span class="line">127.0.0.1 vagrant-centos64.vagrantup.com</span><br></pre></td></tr></table></figure>
<h3 id="遇到问题-3："><a href="#遇到问题-3：" class="headerlink" title="遇到问题 3："></a>遇到问题 3：</h3><p>使用服务方式和 mysqld_safe 方式启动，均不成功。并且没有错误日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ /opt/mariadb/bin/mysqld_safe --datadir=&apos;/home/mysql/mysql3306&apos; --default-files=&apos;/etc/my.cnf&apos;</span><br><span class="line">161213 02:40:33 mysqld_safe Logging to &apos;/home/mysql/mysql3306/mysql3306.err&apos;.</span><br><span class="line"></span><br><span class="line">$ service mysqld start</span><br><span class="line">Starting MySQL.161213 02:52:34 mysqld_safe Logging to &apos;/home/mysql/mysql3306/error3306.log&apos;.</span><br><span class="line"> ERROR!</span><br></pre></td></tr></table></figure>
<p>因为这两个都是 mysqld_safe 方式启动的，怀疑是 my.cnf 里面 <code>[mysqld_safe]</code> 节点配置错误，遂检查 my.cnf 配置文件，发现 <code>[mysqld_safe]</code> 节点下的 <code>ledir</code> 配置的是 <code>ledir=/home/mysql/mysql3306</code>，查看 MySQL 官方文档：[[<a href="http://dev.mysql.com/doc/refman/5.7/en/mysqld-safe.html" target="_blank" rel="noopener">5.3.2 mysqld_safe — MySQL Server Startup Script</a>]，此参数需要配置的是指向 mysqld 程序的目录路径，使用该选项来显式表示服务器位置。故此，修改为 <code>ledir=/opt/mariadb/bin</code>。重启服务成功。</p>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/mariadb/" rel="tag"># mariadb</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/17/install-mysql/" rel="next" title="MySQL 安装部署">
                <i class="fa fa-chevron-left"></i> MySQL 安装部署
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/17/install-zabbix/" rel="prev" title="安装部署 Zabbix">
                安装部署 Zabbix <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">Yang Chuang</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>



  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>











          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-的版本选择及安装部署"><span class="nav-number">1.</span> <span class="nav-text">MySQL 的版本选择及安装部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#版本选取"><span class="nav-number">1.1.</span> <span class="nav-text">版本选取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装部署"><span class="nav-number">1.2.</span> <span class="nav-text">安装部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统版本及安装介质"><span class="nav-number">1.2.1.</span> <span class="nav-text">系统版本及安装介质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下载-MariaDB-安装介质"><span class="nav-number">1.2.2.</span> <span class="nav-text">下载 MariaDB 安装介质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-MariaDB-服务"><span class="nav-number">1.2.3.</span> <span class="nav-text">安装 MariaDB 服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置数据库实例参数"><span class="nav-number">1.2.4.</span> <span class="nav-text">配置数据库实例参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动-MariaDB-实例"><span class="nav-number">1.2.5.</span> <span class="nav-text">启动 MariaDB 实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-root-用户密码"><span class="nav-number">1.2.6.</span> <span class="nav-text">配置 root 用户密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-root-用户远程访问"><span class="nav-number">1.2.7.</span> <span class="nav-text">配置 root 用户远程访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遇到问题-1："><span class="nav-number">1.2.8.</span> <span class="nav-text">遇到问题 1：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遇到问题-2："><span class="nav-number">1.2.9.</span> <span class="nav-text">遇到问题 2：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遇到问题-3："><span class="nav-number">1.2.10.</span> <span class="nav-text">遇到问题 3：</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yang Chuang</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  










  





















<script>
// GET RESPONSIVE HEIGHT PASSED FROM IFRAME

window.addEventListener("message", function(e) {
  var data = e.data;
  if ((typeof data === 'string') && (data.indexOf('ciu_embed') > -1)) {
    var featureID = data.split(':')[1];
    var height = data.split(':')[2];
    $(`iframe[data-feature=${featureID}]`).height(parseInt(height) + 30);
  }
}, false);
</script>








  

</body>
</html>
